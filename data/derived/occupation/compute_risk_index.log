
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      17.0
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2021 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-STATA-PC        https://www.stata.com
                                   979-696-4600        stata@stata.com

Stata license: Single-user 2-core  perpetual
Serial number: 501706328764
  Licensed to: Miklos Koren
               CEU MicroData

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000; see help set_maxvar.

. do compute_risk_index.do 

. ******
. *crosswalk
. use "../crosswalk/census2010_soc2010.dta", clear

. keep census2010 soccode2010

. duplicates drop

Duplicates in terms of all variables

(1 observation deleted)

. drop if   census2010=="" | soccode2010==""
(4 observations deleted)

. destring (census2010), replace
census2010: all characters numeric; replaced as int

. 
. sort census2010

. tempfile crosswalk

. save `crosswalk'
file /var/folders/f4/7drmhl1d5kj3wp1r33jvx32m0000gn/T//St03750.000001 saved
    as .dta format

. 
. *****
. *atus data
. use "../time-use/atus_working_at_home_occupationlevel.dta", clear 

. 
. rename teio1ocd census2010

. merge 1:m census2010 using `crosswalk', keep(1 3) nogenerate

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                               709  
    -----------------------------------------

. 
. rename soccode2010 SOCCode

. tempfile atus

. save `atus'
file /var/folders/f4/7drmhl1d5kj3wp1r33jvx32m0000gn/T//St03750.000002 saved
    as .dta format

. 
. clear

. import delimited "../../clean/onet/risks.csv", case(preserve) varnames(1)
(encoding automatically selected: ISO-8859-1)
(25 vars, 736 obs)

. 
. **************
. *generating summery indexes: communication and infection measures
. *************
. local teamwork group consult coordinate team guide

. local customer customers public care interpersonal consult

. local presence move operate repair_elect repair_mechanic inspect

. 
. 
. * face2face daily, more frequently than either email or memos
. local teamwork_context ((face2face > 75)&(face2face > email)&(face2face > mem
> o))

. local customer_context ((face2face > 75)&(face2face > email)&(face2face > mem
> o))

. * share office or more dense
. local presence_context (proximity > 25)

. 
. * for tasks
. local cutoff = 62.5

. 
. * explore correlations between components with a group
. foreach G in teamwork customer presence {
  2.         scalar corr_`G' = 0
  3.         scalar N_`G' = 0
  4.         local I: word count ``G''
  5.         forval i = 2/`I' {
  6.                 local left: word `i' of ``G''
  7.                 local J = `i'-1
  8.                 forval j = 1/`J' {
  9.                         local right: word `j' of ``G''
 10.                         quietly correlate `left' `right'
 11.                         
.                         * cumulate average
.                         scalar N_`G' = N_`G' + 1
 12.                         scalar corr_`G' = ( (corr_`G' * (N_`G'-1)) + r(rho
> ) ) / N_`G'
 13.                 }
 14.         }
 15.         display "Correlation within `G': " corr_`G'
 16. }
Correlation within teamwork: .60617054
Correlation within customer: .42659172
Correlation within presence: .69164458

. 
. * interaction for teamwork
. egen teamwork = rowmean(`teamwork')

. * customer communication
. egen customer = rowmean(`customer')

. * require physical presence in close proximity to others
. egen presence = rowmean(`presence')

. 
. foreach X of var teamwork customer presence {
  2.         generate `X'_interact_index = round(``X'_context' * (`X'))
  3.         generate `X'_index = round((`X'))
  4.         
.         generate  `X'_interact = ``X'_context' * (`X' >= `cutoff')
  5.         replace `X' = 0 if  (`X' < `cutoff')
  6.         replace `X' = 1 if  (`X' >= `cutoff')
  7. }
(552 real changes made)
(184 real changes made)
(533 real changes made)
(203 real changes made)
(628 real changes made)
(108 real changes made)

. 
. label variable teamwork_index "Teamwork communication index [0,100]"

. label variable customer_index "Customer communication index [0,100]"

. label variable presence_index "Physical presence index [0,100]"

. 
. label variable teamwork_interact_index "Teamwork communication index [0,100] 
> with context cutoff - interaction"

. label variable customer_interact_index "Customer communication index [0,100] 
> with context cutoff - interaction"

. label variable presence_interact_index "Physical presence index [0,100] with 
> context cutoff - interaction"

. 
. 
. label variable teamwork_interact "Teamwork communication (dummy) with context
>  cutoff - interaction"

. label variable customer_interact "Customer communication (dummy) with context
>  cutoff - interaction"

. label variable presence_interact "Physical presence (dummy) with context cuto
> ff - interaction"

. label variable customer_interact "Customer communication (dummy) version 2 wi
> th context cutoff - interaction"

. 
. label variable teamwork "Teamwork communication (dummy)"

. label variable customer "Customer communication (dummy)"

. label variable presence "Physical presence (dummy)"

. label variable customer "Customer communication (dummy)"

. 
. keep SOCCode Description teamwork* customer* presence* 

. drop customers

. compress
  variable teamwork was float now byte
  variable customer was float now byte
  variable presence was float now byte
  variable teamwork_interact_index was float now byte
  variable teamwork_index was float now byte
  variable teamwork_interact was float now byte
  variable customer_interact_index was float now byte
  variable customer_index was float now byte
  variable customer_interact was float now byte
  variable presence_interact_index was float now byte
  variable presence_index was float now byte
  variable presence_interact was float now byte
  (26,496 bytes saved)

. 
. sort SOCCode

. merge 1:1 SOCCode using `atus'

    Result                      Number of obs
    -----------------------------------------
    Not matched                           305
        from master                       166  (_merge==1)
        from using                        139  (_merge==2)

    Matched                               570  (_merge==3)
    -----------------------------------------

. * keep census code for future reference
. 
. /*NOTE
> there are occupations that are only in ONet
> and there are occupations that are only in ATUS
> */
. 
. save "risks.dta", replace
file risks.dta saved

. 
end of do-file
